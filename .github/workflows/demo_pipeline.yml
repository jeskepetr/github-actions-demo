name: Demo pipeline
on: push

jobs:

  ##########################
  #  SETUP STAGE
  ##########################
  setup-stage:
    runs-on: ubuntu-latest
    env:
      NAME: General Kenobi
    steps:
      - name: Greet
        run: |
          echo "Hello there"
          echo "$NAME"

  #########################
  #  ACTIONS DEMO STAGE
  #########################
  actions-demo-stage:
    runs-on: ubuntu-latest
    needs: setup-stage
    permissions:
      pull-requests: write
    steps:
      - name: Add pr comment
        uses: mshick/add-pr-comment@v2
        with:
          message: "**Hello** üåè !"
      - name: Call custom action
        id: demo_call
        uses: jeskepetr/github-actions-by-pj/demo@main
      - name: Print demo output
        run: echo "Random-number ${{ steps.demo_call.outputs.random-number }}"
        shell: bash

  ##########################
  #  CREATE ARTIFACT STAGE
  ##########################
  create-artifact-stage:
    needs: setup-stage
    uses: ./.github/workflows/rw_create_artifact.yml

  ##########################
  #  READ ARTIFACT STAGE
  ##########################
  download-artifact-stage:
    needs: create-artifact-stage
    uses: ./.github/workflows/rw_download_artifact.yml

  ##########################
  #  GENERATE OUTPUTS STAGE
  ##########################
  generate-outputs-stage:
    needs: setup-stage
    uses: ./.github/workflows/rw_generate_outputs.yml

  ##########################
  #  READ OUTPUTS STAGE
  ##########################
  read-outputs-stage:
    needs: generate-outputs-stage
    uses: ./.github/workflows/rw_read_outputs.yml
    with:
      changed-components: ${{ needs.generate-outputs-stage.outputs.changed-components }}

  ##########################
  #  MATRIX DEMO STAGE
  ##########################
  run-matrix-job:
    name: Run matrix job
    runs-on: ubuntu-latest
    strategy:
      matrix:
        component: ["a", "b"]
    steps:
      - name: Matrix job
        run: |
          echo "Running build for component: ${{ matrix.component }}"

name: Demo pipeline
on: push

jobs:

  ##########################
  #  SETUP STAGE
  ##########################
  setup-stage:
    runs-on: ubuntu-latest
    env:
      NAME: General Kenobi
    steps:
      - name: Greet
        run: |
          echo "Hello there"
          echo "$NAME"

  ##############################################################################
  #  ACTIONS DEMO STAGE
  ##############################################################################
  # Market-place link ‚Äì> https://github.com/marketplace/actions/add-pr-comment
  # Custom action link ‚Äì> https://github.com/jeskepetr/github-actions-by-pj
  # Gooddata Github actions -> https://github.com/gooddata/github-actions
  ##############################################################################
  actions-demo-stage:
    runs-on: ubuntu-latest
    needs: setup-stage
    permissions:
      pull-requests: write
    steps:
      - name: Add pr comment
        uses: mshick/add-pr-comment@v2
        with:
          message: "**Hello** üåè !"
      - name: Call custom action
        id: demo_call
        uses: jeskepetr/github-actions-by-pj/demo@main
      - name: Print demo output
        run: echo "Random-number - ${{ steps.demo_call.outputs.random-number }}"
        shell: bash

  ##########################
  #  CREATE ARTIFACT STAGE
  ##########################
  create-artifact-stage:
    needs: actions-demo-stage
    uses: ./.github/workflows/rw_create_artifact.yml

  ##########################
  #  READ ARTIFACT STAGE
  ##########################
  download-artifact-stage:
    needs: create-artifact-stage
    uses: ./.github/workflows/rw_download_artifact.yml

